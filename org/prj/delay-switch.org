#+STARTUP: showall indent hidestars
#+TOC: headlines 3

#+TITLE: Выключатель с задержкой выключения

* Интро

Это учебно-тестовый проект, в котором на примере простой схемы можно пройти все этапы
проектирования электронного устройства на микроконтроллере.

* Задача

Требуется собрать устройство, управляемое кнопкой по следующему алгоритму:
- В состоянии "выключено" нажатие кнопки приводит к включению нагрузки и переходу в
  состояние "включено"
- В состоянии "включено" нажатие кнопки приводит к выключению нагрузки и переходу в
  состояние "выключено"
- В состоянии "включено" через заданное в программе время устройство самостоятельно
  выключает нагрузку и переходит в состояние "выключено"

Применение: устройство может служить выключателем света в туалете/ванной комнате,
предотвращая ситуацию "забыли выключить"

* Прототипирование

Для прототипирования воспользуемся =Arduino Uno= и модулем расширения =Relay Shield=.

В ОС Ubuntu 16.04 установим =Arduino IDE 1.8.9= с сайта https://www.arduino.cc запустив
в терминале =./install.sh=

Чтобы проверить работоспособность платы и модуля расширения загрузим следующий скетч:

#+BEGIN_SRC c
  const int Relay_1 = 4;
  const int Relay_2 = 5;
  const int Relay_3 = 6;
  const int Relay_4 = 7;

  void setup()  {
      pinMode(Relay_1, OUTPUT);
      pinMode(Relay_2, OUTPUT);
      pinMode(Relay_3, OUTPUT);
      pinMode(Relay_4, OUTPUT);
  }

  void loop()  {
      digitalWrite(Relay_1,HIGH);
      delay(500);
      digitalWrite(Relay_1,LOW);
      delay(500);

      digitalWrite(Relay_2,HIGH);
      delay(500);
      digitalWrite(Relay_2,LOW);
      delay(500);

      digitalWrite(Relay_3,HIGH);
      delay(500);
      digitalWrite(Relay_3,LOW);
      delay(500);

      digitalWrite(Relay_4,HIGH);
      delay(500);
      digitalWrite(Relay_4,LOW);
      delay(500);
  }
#+END_SRC

Чтобы загрузить этот скетч мне понадобилось разрешить доступ к порту следующей
командой:

#+BEGIN_SRC sh
  sudo chmod a+rw /dev/ttyACM0
#+END_SRC

или добавить текущего пользователя в группу которой это разрешено

#+BEGIN_SRC sh
  sudo usermod -a -G dialout $USER
#+END_SRC

Теперь нам потребуется подключить кнопку на 8 пин. Резистор на 100 Ом подтягивает 8
пин к земле, когда кнопка не нажата:

[pic]

#+BEGIN_SRC c
  const int Relay_1 = 4;
  const int Button_1 = 8;

  int State = 0;

  void setup()  {
      pinMode(Relay_1, OUTPUT);
      pinMode(Button_1, INPUT);
  }

  void loop()  {
      State = digitalRead(Button_1);

      if (State) {
          digitalWrite(Relay_1,HIGH);
      } else {
          digitalWrite(Relay_1,LOW);
      }
  }
#+END_SRC

В этом скетче =Relay_1= срабатывает, когда кнопка нажата.

[video]
